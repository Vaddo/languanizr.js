/**
 * LanguanizrEditor.js v0.1.0
 *
 * Client side translation script
 * -
 * Create multi language sites fast and simple.
 *
 *
 * Http://www.languanizrjs.com
 * https://github.com/Vaddo/languanizr.js/tree/editor
 *
 * MIT licensed
 *
 * Copyright (C) 2013 - A project by Vadim Hermann - http://www.vadim-hermann.com
 */
var languanizrEditor={_version:"0.1.0",_editor:$("#languanizrEditor"),_body:$("#editorBody"),_head:$("#editorHead"),init:function(){var a=this._body.find(".dataCol"),b=this._head.find(".langCol");this._bindDocumentEvents()._bindBodyCellEvents(a)._bindHeadCellEvents(b)._head.find(".col1").focus();return this},triggerGeneration:function(){languanizrEditor._controlEBehavior(me,keyCode)},_bindDocumentEvents:function(){$(document).on("keydown",function(a){var b=a.keyCode;if(a.ctrlKey&&languanizrEditor._controlPBehavior(b))return!1;
languanizrEditor._escapeBehavior(b)});return this},_bindBodyCellEvents:function(a){a.on("focusin",function(){var a=$(this);a.parent().addClass("selected");a.one("focusout",function(){$("#lastFocused").attr("id","");$(this).off("keydown").attr("id","lastFocused").parent().removeClass("selected")}).on("keydown",function(a){var b=a.keyCode,e=$(this);a.shiftKey||languanizrEditor._tabBehavior(e,b);if(!a.ctrlKey&&languanizrEditor._enterBehavior(e,b)||a.ctrlKey&&(languanizrEditor._controlCBehavior(e,b),
languanizrEditor._controlPosBehavior(b),languanizrEditor._controlEndBehavior(b),languanizrEditor._controlBackspaceBehavior(e,b)||languanizrEditor._controlDelBehavior(e,b)||languanizrEditor._controlEBehavior(e,b)))return!1;languanizrEditor._arrowTopBehaviour(e,b);languanizrEditor._arrowRightBehaviour(e,b);languanizrEditor._arrowBottomBehaviour(e,b);languanizrEditor._arrowLeftBehaviour(e,b)})});return this},_bindHeadCellEvents:function(a){a.on("focusin",function(){$(this).one("focusout",function(){$(this).off("keydown")}).on("keydown",
function(a){var c=a.keyCode,d=$(this);if(!a.ctrlKey&&languanizrEditor._enterBehavior(d,c)||a.ctrlKey&&(languanizrEditor._controlPosBehavior(c),languanizrEditor._controlEndBehavior(c),languanizrEditor._controlBackspaceBehavior(d,c)||languanizrEditor._controlEBehavior(d,c)))return!1;languanizrEditor._arrowRightBehaviour(d,c);languanizrEditor._arrowBottomBehaviour(d,c);languanizrEditor._arrowLeftBehaviour(d,c)})});return this},_tabBehavior:function(a,b){9==b&&languanizrEditor._isLastCell(a)&&languanizrEditor._createRow()},
_enterBehavior:function(a,b){if(13==b){var c=languanizrEditor._getColIndex(a);"th"==a.context.tagName.toLowerCase()?languanizrEditor._focusFirstRow(c):(languanizrEditor._isLastRow(a)&&languanizrEditor._createRow(),languanizrEditor._focusNextRow(a,c));return!0}return!1},_escapeBehavior:function(a){27==a&&(a=$("#contentWrapper"),a.hasClass("json")&&(a.removeClass("json").addClass("editor"),$("#lastFocused").focus()))},_controlPBehavior:function(a){return 80==a?(languanizrEditor._createColumn(),!0):
!1},_controlEBehavior:function(a,b){if(69==b){var c=languanizrEditor._body.find(".idCol"),d=languanizrEditor._getRowCount(),e=languanizrEditor._getColIndex(a),f,g,h;g='{"title": "Languanizr language package", "url": "http://www.languanizr.com", "package_version": '+$("#nextPackageVersion").text()+', "language": "'+languanizrEditor._head.find(".col"+e).text()+'", "words": {';for(f=1;f<=d;++f)h=$(c[f-1]),g+='"'+h.text()+'": "'+h.siblings(".col"+e).text()+'"',g+=f!=d?", ":"";g+="}}";$("#contentWrapper").removeClass().addClass("contentWrapper json");
$("#field").val(g).select();return!0}return!1},_controlDelBehavior:function(a,b){if(46==b&&1<languanizrEditor._getRowCount()){var c=languanizrEditor._getColIndex(a);languanizrEditor._focusNextRow(a,c)||languanizrEditor._focusPrevRow(a,c);a.off("keydown").parent().remove();return!0}return!1},_controlCBehavior:function(a,b){if(67==b){var c="{$#"+a.siblings(".idCol").text()+"#"+a.text()+"$}";$("#languanizrEditorPlaceholder").val(c).select();setTimeout(function(){$("#lastFocused").focus()},100)}},_controlPosBehavior:function(a){36==
a&&languanizrEditor._focusFirstRow(1)},_controlEndBehavior:function(a){35==a&&languanizrEditor._focusLastRow(languanizrEditor._getColCount())},_controlBackspaceBehavior:function(a,b){if(8==b){var c=languanizrEditor._getColIndex(a);1!=c&&languanizrEditor._focusFirstRow(c-1);1<languanizrEditor._getColCount()&&$(".col"+c).off("focusin, focusout, keydown").remove()}},_arrowTopBehaviour:function(a,b){if(38==b){var c=languanizrEditor._getColIndex(a);languanizrEditor._isFirstRow(a)?languanizrEditor._focusHeadRow(c):
languanizrEditor._focusPrevRow(a,c)}},_arrowRightBehaviour:function(a,b){if(39==b){var c=parseInt(languanizrEditor._getColIndex(a));a.siblings(".col"+(c+1)).focus()}},_arrowBottomBehaviour:function(a,b){if(40==b){var c=languanizrEditor._getColIndex(a);"th"==a.context.tagName.toLowerCase()?languanizrEditor._focusFirstRow(c):languanizrEditor._focusNextRow(a,c)}},_arrowLeftBehaviour:function(a,b){if(37==b){var c=parseInt(languanizrEditor._getColIndex(a));a.siblings(".col"+(c-1)).focus()}},_createRow:function(){var a=
languanizrEditor._editor,b=parseInt(a.attr("data-latest-id"))+1,c=languanizrEditor._getColCount()+1,d='<tr><td class="idCol">'+b+"</td>";for(i=1;i<c;++i)d+='<td class="col'+i+' dataCol" contenteditable="true"></td>';c=$(d+"</tr>");d=c.find(".dataCol");a.attr("data-latest-id",b);languanizrEditor._bindBodyCellEvents(d)._body.append(c)},_createColumn:function(){var a=languanizrEditor._getColCount(),b=languanizrEditor._getRowCount(),c=languanizrEditor._body.find("tr"),d,e,f;0==a&&head.append('<th id="idCol"></th>');
++a;d=$('<th class="col'+a+' langCol" contenteditable="true">super cool language</th>');languanizrEditor._bindHeadCellEvents(d)._head.append(d);for(e=0;e<b;++e)d=$(c[e]),0==d.has("td").length&&d.append('<td class="idField">'+i+"</td>"),f=$('<td class="col'+a+' dataCol" contenteditable="true"></td>'),languanizrEditor._bindBodyCellEvents(f),d.append(f);languanizrEditor._head.find("th:last").focus()},_isLastCell:function(a){return a.parent().is(":last-child")&&a.is(":last-child")},_isFirstRow:function(a){return a.parent().is(":first-child")},
_isLastRow:function(a){return a.parent().is(":last-child")},_getColIndex:function(a){return a.attr("class").replace("dataCol","").replace("langCol","").replace("col","")},_focusPrevRow:function(a,b){var c=a.parent().prev("tr");return 0!=c.length?(c.find(".col"+b).focus(),!0):!1},_focusNextRow:function(a,b){var c=a.parent().next("tr");return 0!=c.length?(c.find(".col"+b).focus(),!0):!1},_focusFirstRow:function(a){languanizrEditor._body.find("tr:first").find(".col"+a).focus()},_focusLastRow:function(a){languanizrEditor._body.find("tr:last").find(".col"+
a).focus()},_getColCount:function(){return languanizrEditor._head.find("th").length-1},_getRowCount:function(){return languanizrEditor._body.find("tr").length},_focusHeadRow:function(a){languanizrEditor._head.find(".col"+a).focus()}};